#!/bin/bash
set -e
if [ "$(id -u)" -ne 0 ]; then
    echo -e 'Script must be run as root.'
    exit 1
fi

SCRIPT_NAME="$(basename "${BASH_SOURCE[0]}")"
FEATURE_PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
FEATURE_ID="$(basename "${FEATURE_PATH}")"
BP_CONTAINER_BUILD_MODE="${BP_CONTAINER_BUILD_MODE:-devcontainer}"

# Import common utils
. "${FEATURE_PATH}/../../common/utils.sh"

set_var_to_option_value "${FEATURE_ID}" build_mode build_mode "devcontainer"
set_var_to_option_value "${FEATURE_ID}" nodeGypDependencies node_gyp "true"

# If enabled, verify "python3", "make", "gcc", "g++" commands are available so node-gyp works - https://github.com/nodejs/node-gyp
if [ "${build_mode}" = "devcontainer" ] && [ "${node_gyp}" = "true" ]; then
    check_command make make
    check_command gcc gcc
    check_command g++ g++
    check_command python3 python3-minimal
fi